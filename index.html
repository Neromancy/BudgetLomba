
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zenith Budget</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
      // Force-unregister any existing service workers. This is a common fix for deployment
      // issues where a stale service worker from a previous project caches files
      // and causes loading errors after a new deployment.
      if (window.navigator && navigator.serviceWorker) {
        navigator.serviceWorker.getRegistrations()
          .then(registrations => {
            if (registrations.length) {
              console.log('Unregistering stale service workers...');
              for (const registration of registrations) {
                registration.unregister();
              }
              // After unregistering, reload the page to ensure the new content is fetched
              // without interception. A timeout gives the unregister call time to complete.
              setTimeout(() => window.location.reload(), 500);
            }
          })
          .catch(error => {
            console.error('Error unregistering service worker:', error);
          });
      }
    </script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              background: '#f8fafc', // slate-50
              surface: '#ffffff',
              primary: {
                DEFAULT: '#6366f1', // indigo-500
                hover: '#4f46e5',   // indigo-600
                light: '#eef2ff',   // indigo-50
                text: '#ffffff'
              },
              secondary: {
                DEFAULT: '#64748b', // slate-500
                hover: '#475569',   // slate-600
              },
              accent: {
                DEFAULT: '#10b981', // emerald-500
                light: '#ecfdf5',   // emerald-50
                text: '#065f46'    // emerald-800
              },
              danger: {
                DEFAULT: '#ef4444', // red-500
                light: '#fee2e2',   // red-100
                text: '#991b1b'     // red-800
              },
              warning: {
                DEFAULT: '#f59e0b', // amber-500
                light: '#fffbeb',   // amber-50
                text: '#b45309'     // amber-700
              },
              text: {
                primary: '#1e293b', // slate-800
                secondary: '#64748b', // slate-500
                muted: '#94a3b8',   // slate-400
              },
              brand: '#6366f1',
              border: '#e2e8f0', // slate-200
            },
            keyframes: {
              'fade-in-up': {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
            },
            animation: {
              'fade-in-up': 'fade-in-up 0.3s ease-out forwards',
            },
          }
        }
      }
    </script>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.1.1",
    "react-dom/client": "https://aistudiocdn.com/react-dom@^19.1.1/client",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
    "react/": "https://aistudiocdn.com/react@^19.1.1/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.21.0",
    "recharts": "https://aistudiocdn.com/recharts@^3.2.1",
    "react-markdown": "https://aistudiocdn.com/react-markdown@^10.1.0"
  }
}
</script>
<!-- Babel for in-browser JSX/TSX transpilation -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
  <body class="bg-background">
    <div id="root"></div>
    <script type="text/babel" data-type="module" data-presets="react,typescript">
      // Polyfill for process.env in a browser environment where it doesn't exist.
      // This prevents a "process is not defined" crash and allows the app to render.
      // AI features will not work until a valid API_KEY is configured for this environment.
      if (typeof window.process === 'undefined') {
        window.process = { env: { API_KEY: undefined } };
      }

      import React, { useState, useMemo, useEffect } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenAI, GenerateContentResponse, Type } from '@google/genai';
      import { PieChart, Pie, Cell, ResponsiveContainer, Tooltip } from 'recharts';
      import ReactMarkdown from 'react-markdown';

      // --- INLINED CODE ---
      // The contents of all .js files have been moved here to create a single "bundle".
      // This solves module loading issues on static hosting platforms.
      
      // --- START: types.js ---
      const TransactionType = {
        INCOME: 'income',
        EXPENSE: 'expense',
      };
      
      // --- END: types.js ---

      // --- START: components/Icons.js ---
      const DashboardIcon = ({ title, ...props }) => (
        <svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          {title && <title>{title}</title>}
          <path strokeLinecap="round" strokeLinejoin="round" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
        </svg>
      );

      const TransactionsIcon = ({ title, ...props }) => (
        <svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          {title && <title>{title}</title>}
          <path strokeLinecap="round" strokeLinejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
        </svg>
      );

      const GoalsIcon = ({ title, ...props }) => (
        <svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          {title && <title>{title}</title>}
          <path strokeLinecap="round" strokeLinejoin="round" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6H8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9" />
        </svg>
      );

      const PlusIcon = ({ title, ...props }) => (
        <svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          {title && <title>{title}</title>}
          <path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" />
        </svg>
      );

      const CameraIcon = ({ title, ...props }) => (
          <svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor">
              {title && <title>{title}</title>}
              <path strokeLinecap="round" strokeLinejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.776 48.776 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" />
              <path strokeLinecap="round" strokeLinejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" />
          </svg>
      );

      const SparklesIcon = ({ title, ...props }) => (
          <svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor">
              {title && <title>{title}</title>}
              <path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.5 21.75l-.398-1.188a3.375 3.375 0 00-2.456-2.456L12.75 18l1.188-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.188a3.375 3.375 0 002.456 2.456L20.25 18l-1.188.398a3.375 3.375 0 00-2.456 2.456z" />
          </svg>
      );

      const XIcon = ({ title, ...props }) => (
          <svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor">
              {title && <title>{title}</title>}
              <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
      );

      const StarIcon = ({ title, ...props }) => (
        <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          {title && <title>{title}</title>}
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg>
      );

      const LoadingSpinner = ({ title, ...props }) => (
          <svg {...props} className={`animate-spin ${props.className || ''}`} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              {title && <title>{title}</title>}
              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
      );
      // --- END: components/Icons.js ---

      // --- START: constants.js ---
      const DEFAULT_CATEGORIES = [
        'Groceries',
        'Dining Out',
        'Transport',
        'Utilities',
        'Rent',
        'Entertainment',
        'Shopping',
        'Health',
        'Salary',
        'Freelance',
        'Other',
      ];

      const POINTS_FOR_TRANSACTION = 10;
      const POINTS_FOR_NEW_GOAL = 25;
      const POINTS_FOR_COMPLETING_GOAL = 100;

      const MOCK_RECEIPT_IMAGE_BASE64 = 'iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAIAAAC/gL+PAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABYSURBVHja7cEBDQAAAMIg+6e2xweMCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8GEAATwAAVsm3wAAAABJRU5ErkJggg==';
      // --- END: constants.js ---

      // --- START: services/geminiService.js ---
      if (!process.env.API_KEY) {
        console.warn("API_KEY environment variable not set. Gemini API calls will fail.");
      }

      const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });

      const scanReceipt = async (base64ImageData) => {
        try {
          const imagePart = {
            inlineData: {
              mimeType: 'image/jpeg',
              data: base64ImageData,
            },
          };

          const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: { 
              parts: [
                imagePart, 
                { text: 'Analyze this receipt image. Extract merchant name, total amount (as a number), and date (in YYYY-MM-DD format).' }
              ] 
            },
            config: {
              responseMimeType: 'application/json',
              responseSchema: {
                type: Type.OBJECT,
                properties: {
                  merchant: { type: Type.STRING },
                  total: { type: Type.NUMBER },
                  date: { type: Type.STRING },
                },
              },
            },
          });

          const jsonText = response.text.trim();
          return JSON.parse(jsonText);
        } catch (error) {
          console.error('Error scanning receipt:', error);
          return {};
        }
      };

      const suggestCategory = async (description, existingCategories) => {
        try {
          const prompt = `Given the transaction description "${description}", suggest the most likely category. Prioritize categories from this list: [${existingCategories.join(', ')}]. If none fit well, suggest a new, appropriate, single-word category. Respond with only the category name, without any extra text or punctuation.`;
          
          const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
          });
          
          return response.text.trim();
        } catch (error) {
          console.error('Error suggesting category:', error);
          return '';
        }
      };

      const analyzeScenario = async (scenario, financials) => {
          try {
              const prompt = `A user wants to know the impact of a financial scenario. 
              Current Financials:
              - Monthly Income: $${financials.income.toFixed(2)}
              - Monthly Expenses: $${financials.expenses.toFixed(2)}
              - Current Balance: $${financials.balance.toFixed(2)}
              - Savings Goals: ${financials.goals.map(g => `${g.name} ($${g.targetAmount})`).join(', ')}

              Scenario: "${scenario}"

              Analyze the impact of this scenario on their balance and savings goals. Provide a concise summary and updated timelines for their goals. Respond in simple markdown format.`;

              const response = await ai.models.generateContent({
                  model: 'gemini-2.5-flash',
                  contents: prompt,
                  config: {
                    systemInstruction: 'You are a helpful financial advisor providing "what-if" scenario analysis.'
                  }
              });
              return response.text;
          } catch (error) {
              console.error('Error analyzing scenario:', error);
              return 'Sorry, I was unable to analyze that scenario. Please try again.';
          }
      };

      const suggestGoals = async (financials) => {
          try {
              const prompt = `Based on the user's financials (Monthly Income: $${financials.income}, Monthly Expenses: $${financials.expenses}, Current Balance: $${financials.balance}), suggest three distinct and realistic savings goals with appropriate target amounts.`;
              
              const response = await ai.models.generateContent({
                  model: 'gemini-2.5-flash',
                  contents: prompt,
                  config: {
                      responseMimeType: 'application/json',
                      responseSchema: {
                          type: Type.ARRAY,
                          items: {
                              type: Type.OBJECT,
                              properties: {
                                  name: { type: Type.STRING },
                                  targetAmount: { type: Type.NUMBER },
                              }
                          }
                      }
                  }
              });

              const jsonText = response.text.trim();
              return JSON.parse(jsonText);
          } catch (error) {
              console.error('Error suggesting goals:', error);
              return [];
          }
      };

      const createBudgetPlan = async (goal, balance, transactions) => {
          try {
              const simplifiedTransactions = transactions.map(t => `${t.type} of $${t.amount} for ${t.description} (${t.category}) on ${t.date}`).join('\n');
              
              const prompt = `A user wants a budget plan to save for their goal: "${goal.name}" which has a target of $${goal.targetAmount}. Their current balance is $${balance}. Here are their 20 most recent transactions to understand their spending habits:\n${simplifiedTransactions}\n\nCreate a simple, actionable budget plan in markdown.
          
          The plan MUST start with a "Summary" section inside a markdown blockquote (>). This summary should give a one-sentence overview of the projected timeline and the single most important action they should take.
          
          After the summary, include these sections:
          - **Projected Timeline:** A realistic estimate of how long it will take to reach the goal.
          - **Spending Limits:** Specific monthly spending limits for 2-3 key expense categories based on their history.
          - **Personalized Savings Tips:** Two actionable tips based on their transactions.`;

              const response = await ai.models.generateContent({
                  model: 'gemini-2.5-flash',
                  contents: prompt,
                   config: {
                      systemInstruction: "You are a friendly budget planner creating simple, motivational financial plans."
                  }
              });
              return response.text;
          } catch (error) {
              console.error('Error creating budget plan:', error);
              return 'Sorry, I was unable to create a budget plan. Please try again.';
          }
      };

      const updateBudgetPlan = async (goal, balance, transactions, previousPlan) => {
          try {
              const simplifiedTransactions = transactions.map(t => `${t.type} of $${t.amount} for ${t.description} (${t.category}) on ${t.date}`).join('\n');

              const prompt = `A user wants to update their budget plan for the goal: "${goal.name}" (Target: $${goal.targetAmount}). Their current balance is $${balance}.

              Here is their **previous plan**:
              ---
              ${previousPlan}
              ---
              
              Here are their **20 most recent transactions** to analyze their latest spending habits:
              ---
              ${simplifiedTransactions}
              ---
              
              Analyze their progress and recent spending. Generate an **updated, complete budget plan** in markdown.
              - The new plan should replace the old one entirely.
              - **Crucially, identify any significant "unplanned" spending** that deviates from the previous plan's suggestions and mention how to get back on track.
              - Start with an updated "Summary" blockquote.
              - Include updated Timeline, Spending Limits, and Savings Tips sections.`;
              
              const response = await ai.models.generateContent({
                  model: 'gemini-2.5-flash',
                  contents: prompt,
                  config: {
                      systemInstruction: "You are a friendly budget planner updating a user's financial plan."
                  }
              });
              return response.text;
          } catch (error) {
              console.error('Error updating budget plan:', error);
              return 'Sorry, I was unable to update the budget plan. Please try again.';
          }
      };
      // --- END: services/geminiService.js ---

      // --- START: components/Modal.js ---
      const Modal = ({ isOpen, onClose, title, children }) => {
        if (!isOpen) return null;

        return (
          <div 
            className="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center"
            onClick={onClose}
          >
            <div 
              className="bg-surface rounded-lg shadow-xl p-6 w-full max-w-md m-4 relative animate-fade-in-up"
              onClick={(e) => e.stopPropagation()}
            >
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-bold text-text-primary">{title}</h2>
                <button onClick={onClose} className="text-text-muted hover:text-text-secondary">
                  <XIcon className="w-6 h-6" />
                </button>
              </div>
              <div>{children}</div>
            </div>
          </div>
        );
      };
      // --- END: components/Modal.js ---

      // --- START: components/Dashboard.js ---
      const StatCard = ({ title, amount, colorClass }) => (
        <div className="bg-surface p-6 rounded-xl shadow-md flex-1">
          <h3 className="text-md font-medium text-text-secondary">{title}</h3>
          <p className={`text-3xl font-bold ${colorClass}`}>
            ${amount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
          </p>
        </div>
      );

      const Dashboard = ({ summary, goals, isPremium }) => {
          const [isPlannerOpen, setPlannerOpen] = useState(false);
          const [scenario, setScenario] = useState('');
          const [analysis, setAnalysis] = useState('');
          const [isLoading, setIsLoading] = useState(false);

          const { totalIncome, totalExpenses, balance } = summary;
          const spentPercentage = totalIncome > 0 ? (totalExpenses / totalIncome) * 100 : 0;

          const chartData = [
              { name: 'Spent', value: totalExpenses },
              { name: 'Remaining', value: totalIncome > totalExpenses ? totalIncome - totalExpenses : 0 },
          ];
          const COLORS = ['#ef4444', '#10b981'];

          const handleAnalyzeScenario = async () => {
              if (!scenario) return;
              setIsLoading(true);
              setAnalysis('');
              const result = await analyzeScenario(scenario, {
                  income: totalIncome,
                  expenses: totalExpenses,
                  balance: balance,
                  goals: goals,
              });
              setAnalysis(result);
              setIsLoading(false);
          };

          return (
              <div className="space-y-8">
                  <div className="flex gap-8">
                      <StatCard title="Total Income" amount={totalIncome} colorClass="text-accent" />
                      <StatCard title="Total Expenses" amount={totalExpenses} colorClass="text-danger" />
                      <StatCard title="Current Balance" amount={balance} colorClass="text-primary" />
                  </div>

                  <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                      <div className="lg:col-span-2 bg-surface p-6 rounded-xl shadow-md">
                          <h3 className="text-xl font-bold mb-4 text-text-primary">Budget Breakdown</h3>
                          <div className="h-80">
                              <ResponsiveContainer width="100%" height="100%">
                                  <PieChart>
                                      <Pie
                                          data={chartData}
                                          cx="50%"
                                          cy="50%"
                                          innerRadius={80}
                                          outerRadius={120}
                                          fill="#8884d8"
                                          paddingAngle={5}
                                          dataKey="value"
                                      >
                                          {chartData.map((entry, index) => (
                                              <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                                          ))}
                                      </Pie>
                                      <Tooltip formatter={(value) => `$${value.toFixed(2)}`} />
                                      <text x="50%" y="50%" textAnchor="middle" dominantBaseline="middle" className="text-3xl font-bold fill-text-primary">
                                          {spentPercentage.toFixed(0)}%
                                      </text>
                                      <text x="50%" y="50%" dy="25" textAnchor="middle" className="text-md fill-text-secondary">
                                          of income spent
                                      </text>
                                  </PieChart>
                              </ResponsiveContainer>
                          </div>
                      </div>

                      <div className="bg-surface p-6 rounded-xl shadow-md flex flex-col">
                          <h3 className="text-xl font-bold mb-4 text-text-primary">Scenario Planner</h3>
                          <p className="text-text-secondary mb-4 flex-grow">
                              Explore how financial changes could impact your goals with our AI-powered planner.
                          </p>
                          <button
                              onClick={() => setPlannerOpen(true)}
                              disabled={!isPremium}
                              className={`w-full flex items-center justify-center font-bold py-3 px-4 rounded-lg transition-colors ${
                                  isPremium
                                      ? 'bg-primary text-primary-text hover:bg-primary-hover'
                                      : 'bg-gray-200 text-text-muted cursor-not-allowed'
                              }`}
                          >
                              <SparklesIcon className="w-5 h-5 mr-2" />
                              What If?
                          </button>
                          {!isPremium && <p className="text-center text-sm text-text-muted mt-2">Premium Feature</p>}
                      </div>
                  </div>
                  
                  <Modal title="AI 'What If?' Scenario Planner" isOpen={isPlannerOpen} onClose={() => setPlannerOpen(false)}>
                      <div className="space-y-4">
                          <p className="text-text-secondary">
                              Enter a hypothetical change to your finances. For example: "What if my income increases by $300 a month, but my rent goes up by $100?"
                          </p>
                          <textarea
                              value={scenario}
                              onChange={(e) => setScenario(e.target.value)}
                              className="w-full h-24 p-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-light focus:border-primary bg-surface"
                              placeholder="Type your scenario here..."
                          />
                          <button
                              onClick={handleAnalyzeScenario}
                              disabled={isLoading}
                              className="w-full bg-primary text-primary-text font-bold py-2 px-4 rounded-lg hover:bg-primary-hover flex justify-center items-center disabled:bg-gray-400"
                          >
                              {isLoading ? <LoadingSpinner className="w-5 h-5" /> : 'Analyze Scenario'}
                          </button>
                          {analysis && (
                               <div className="prose max-w-none p-4 bg-background rounded-md border border-border">
                                 <ReactMarkdown>{analysis}</ReactMarkdown>
                               </div>
                          )}
                      </div>
                  </Modal>
              </div>
          );
      };
      // --- END: components/Dashboard.js ---

      // --- START: components/TransactionsView.js ---
      const formInputClasses = "mt-1 block w-full p-2 border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-light focus:border-primary bg-surface text-text-primary";

      const TransactionForm = ({ onSubmit, onClose, categories, initialData }) => {
          const [description, setDescription] = useState(initialData?.description || '');
          const [amount, setAmount] = useState(initialData?.amount?.toString() || '');
          const [date, setDate] = useState(initialData?.date || new Date().toISOString().split('T')[0]);
          const [type, setType] = useState(initialData?.type || TransactionType.EXPENSE);
          const [category, setCategory] = useState(initialData?.category || '');
          const [isSuggesting, setIsSuggesting] = useState(false);

          const handleDescriptionBlur = async () => {
              if (description && !category) {
                  setIsSuggesting(true);
                  const suggested = await suggestCategory(description, categories);
                  if (suggested) {
                      setCategory(suggested);
                  }
                  setIsSuggesting(false);
              }
          };
          
          const handleSubmit = (e) => {
              e.preventDefault();
              onSubmit({ description, amount: parseFloat(amount), date, type, category });
              onClose();
          };

          return (
              <form onSubmit={handleSubmit} className="space-y-4">
                  <div>
                      <label className="block text-sm font-medium text-text-secondary">Type</label>
                      <div className="mt-1 flex rounded-md">
                          <button type="button" onClick={() => setType(TransactionType.EXPENSE)} className={`flex-1 px-4 py-2 text-sm font-medium border border-border rounded-l-md ${type === TransactionType.EXPENSE ? 'bg-primary text-primary-text' : 'bg-surface text-text-primary hover:bg-gray-50'}`}>Expense</button>
                          <button type="button" onClick={() => setType(TransactionType.INCOME)} className={`flex-1 px-4 py-2 text-sm font-medium border-t border-b border-r border-border rounded-r-md ${type === TransactionType.INCOME ? 'bg-accent text-primary-text' : 'bg-surface text-text-primary hover:bg-gray-50'}`}>Income</button>
                      </div>
                  </div>
                   <div>
                      <label htmlFor="description" className="block text-sm font-medium text-text-secondary">Description</label>
                      <input type="text" id="description" value={description} onChange={(e) => setDescription(e.target.value)} onBlur={handleDescriptionBlur} className={formInputClasses} required />
                  </div>
                  <div>
                      <label htmlFor="amount" className="block text-sm font-medium text-text-secondary">Amount</label>
                      <input type="number" id="amount" value={amount} onChange={(e) => setAmount(e.target.value)} className={formInputClasses} required step="0.01" />
                  </div>
                   <div className="relative">
                      <label htmlFor="category" className="block text-sm font-medium text-text-secondary">Category</label>
                      <input list="categories" id="category" value={category} onChange={(e) => setCategory(e.target.value)} className={formInputClasses} required />
                      <datalist id="categories">
                          {categories.map(c => <option key={c} value={c} />)}
                      </datalist>
                      {isSuggesting && <LoadingSpinner className="w-5 h-5 absolute right-2 top-9 text-primary" />}
                      {!isSuggesting && !category && description && <SparklesIcon className="w-5 h-5 absolute right-2 top-9 text-warning" title="Category will be suggested" />}
                  </div>
                  <div>
                      <label htmlFor="date" className="block text-sm font-medium text-text-secondary">Date</label>
                      <input type="date" id="date" value={date} onChange={(e) => setDate(e.target.value)} className={formInputClasses} required />
                  </div>
                  <div className="flex justify-end space-x-2 pt-2">
                      <button type="button" onClick={onClose} className="px-4 py-2 text-sm font-medium text-text-primary bg-surface border border-border rounded-md hover:bg-gray-50">Cancel</button>
                      <button type="submit" className="px-4 py-2 text-sm font-medium text-primary-text bg-primary border border-transparent rounded-md shadow-sm hover:bg-primary-hover">Add Transaction</button>
                  </div>
              </form>
          );
      };

      const TransactionsView = ({ transactions, addTransaction, deleteTransaction, categories, isPremium }) => {
          const [isAddModalOpen, setAddModalOpen] = useState(false);
          const [isScanModalOpen, setScanModalOpen] = useState(false);
          const [isLoadingScan, setIsLoadingScan] = useState(false);
          const [scannedData, setScannedData] = useState(null);

          const [filterType, setFilterType] = useState('all');
          const [filterCategory, setFilterCategory] = useState('all');

          const filteredTransactions = useMemo(() => {
              return transactions
                  .filter(t => filterType === 'all' || t.type === filterType)
                  .filter(t => filterCategory === 'all' || t.category === filterCategory);
          }, [transactions, filterType, filterCategory]);
          
          const handleScanReceipt = async () => {
            setIsLoadingScan(true);
            const result = await scanReceipt(MOCK_RECEIPT_IMAGE_BASE64);
            setIsLoadingScan(false);

            if (result.total) {
                const prefillData = {
                    description: result.merchant || 'Scanned Receipt',
                    amount: result.total,
                    date: result.date || new Date().toISOString().split('T')[0],
                    type: TransactionType.EXPENSE,
                };
                setScannedData(prefillData);
                setScanModalOpen(false);
                setAddModalOpen(true);
            } else {
                alert("Could not extract details from the receipt. Please try again.");
            }
          };


          return (
              <div className="bg-surface p-6 rounded-xl shadow-md">
                  <div className="flex justify-between items-center mb-6">
                      <h3 className="text-xl font-bold text-text-primary">Transaction History</h3>
                      <div className="flex space-x-2">
                          <button
                              onClick={() => setScanModalOpen(true)}
                              disabled={!isPremium}
                              className="flex items-center px-4 py-2 text-sm font-medium text-primary-text bg-secondary rounded-md hover:bg-secondary-hover disabled:bg-gray-300 disabled:cursor-not-allowed"
                          >
                              <CameraIcon className="w-5 h-5 mr-2" />
                              Scan Receipt
                          </button>
                          <button onClick={() => { setScannedData(null); setAddModalOpen(true); }} className="flex items-center px-4 py-2 text-sm font-medium text-primary-text bg-primary rounded-md hover:bg-primary-hover">
                              <PlusIcon className="w-5 h-5 mr-2" />
                              Add Transaction
                          </button>
                      </div>
                  </div>

                  {/* Filters */}
                  <div className="flex space-x-4 mb-4">
                      <div>
                          <label htmlFor="type-filter" className="text-sm font-medium text-text-secondary">Type</label>
                          <select id="type-filter" value={filterType} onChange={(e) => setFilterType(e.target.value)} className={formInputClasses}>
                              <option value="all">All</option>
                              <option value={TransactionType.INCOME}>Income</option>
                              <option value={TransactionType.EXPENSE}>Expense</option>
                          </select>
                      </div>
                      <div>
                          <label htmlFor="cat-filter" className="text-sm font-medium text-text-secondary">Category</label>
                           <select id="cat-filter" value={filterCategory} onChange={(e) => setFilterCategory(e.target.value)} className={formInputClasses}>
                              <option value="all">All</option>
                              {categories.map(c => <option key={c} value={c}>{c}</option>)}
                          </select>
                      </div>
                  </div>

                  <div className="overflow-x-auto">
                      <table className="min-w-full divide-y divide-border">
                          <thead className="bg-background">
                              <tr>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">Description</th>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">Amount</th>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">Category</th>
                                  <th className="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">Date</th>
                                  <th className="px-6 py-3 text-right text-xs font-medium text-text-secondary uppercase tracking-wider">Action</th>
                              </tr>
                          </thead>
                          <tbody className="bg-surface divide-y divide-border">
                              {filteredTransactions.map((t, index) => (
                                  <tr key={t.id} className={index % 2 === 0 ? 'bg-surface' : 'bg-background'}>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-text-primary">{t.description}</td>
                                      <td className={`px-6 py-4 whitespace-nowrap text-sm font-medium ${t.type === TransactionType.INCOME ? 'text-accent' : 'text-danger'}`}>
                                          {t.type === TransactionType.INCOME ? '+' : '-'}${t.amount.toFixed(2)}
                                      </td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-text-secondary">
                                          <span className="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-primary-light text-primary">{t.category}</span>
                                      </td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-text-secondary">{t.date}</td>
                                      <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                          <button onClick={() => deleteTransaction(t.id)} className="text-danger hover:text-danger-text">Delete</button>
                                      </td>
                                  </tr>
                              ))}
                          </tbody>
                      </table>
                       {filteredTransactions.length === 0 && <p className="text-center py-8 text-text-secondary">No transactions found.</p>}
                  </div>

                  <Modal isOpen={isAddModalOpen} onClose={() => setAddModalOpen(false)} title="Add New Transaction">
                      <TransactionForm onSubmit={addTransaction} onClose={() => setAddModalOpen(false)} categories={categories} initialData={scannedData || {}} />
                  </Modal>
                  <Modal isOpen={isScanModalOpen} onClose={() => setScanModalOpen(false)} title="Scan Receipt (Premium)">
                      <div className="text-center">
                          <p className="text-text-secondary mb-4">Simulating camera view. Click below to "capture" a receipt image and let AI extract the details.</p>
                          <div className="w-full h-48 bg-gray-200 rounded-md flex items-center justify-center mb-4">
                              <CameraIcon className="w-16 h-16 text-text-muted" />
                          </div>
                          <button onClick={handleScanReceipt} disabled={isLoadingScan} className="w-full bg-primary text-primary-text font-bold py-2 px-4 rounded-lg hover:bg-primary-hover flex justify-center items-center">
                              {isLoadingScan ? <LoadingSpinner className="w-5 h-5"/> : 'Capture & Scan'}
                          </button>
                      </div>
                  </Modal>
              </div>
          );
      };
      // --- END: components/TransactionsView.js ---
      
      // --- START: components/GoalsView.js ---
      const ProgressBar = ({ progress }) => (
          <div className="w-full bg-gray-200 rounded-full h-2.5">
              <div className="bg-accent h-2.5 rounded-full" style={{ width: `${progress}%` }}></div>
          </div>
      );

      const GoalsView = ({ goals, setGoals, addGoal, balance, financialSummary, transactions }) => {
          const [isAddModalOpen, setAddModalOpen] = useState(false);
          const [isSuggestModalOpen, setSuggestModalOpen] = useState(false);
          
          const [isLoadingSuggestions, setIsLoadingSuggestions] = useState(false);
          const [suggestedGoals, setSuggestedGoals] = useState([]);

          const [newGoalName, setNewGoalName] = useState('');
          const [newGoalAmount, setNewGoalAmount] = useState('');

          const handleAddGoal = (e) => {
              e.preventDefault();
              addGoal({ name: newGoalName, targetAmount: parseFloat(newGoalAmount) });
              setNewGoalName('');
              setNewGoalAmount('');
              setAddModalOpen(false);
          };

          const handleSuggestGoals = async () => {
              setIsLoadingSuggestions(true);
              setSuggestedGoals([]);
              const suggestions = await suggestGoals({
                  income: financialSummary.totalIncome,
                  expenses: financialSummary.totalExpenses,
                  balance: financialSummary.balance
              });
              setSuggestedGoals(suggestions);
              setIsLoadingSuggestions(false);
          };

          const handleGenerateOrUpdatePlan = async (goal) => {
              setGoals(prevGoals => prevGoals.map(g => g.id === goal.id ? { ...g, planStatus: 'generating' } : g));

              try {
                  const recentTransactions = transactions.slice(0, 20);
                  let plan;
                  if (goal.budgetPlan) {
                       plan = await updateBudgetPlan(goal, balance, recentTransactions, goal.budgetPlan);
                  } else {
                       plan = await createBudgetPlan(goal, balance, recentTransactions);
                  }
                  setGoals(prevGoals => prevGoals.map(g => g.id === goal.id ? { ...g, budgetPlan: plan, planStatus: 'generated' } : g));
              } catch (error) {
                  console.error("Error generating/updating plan:", error);
                  setGoals(prevGoals => prevGoals.map(g => g.id === goal.id ? { ...g, planStatus: 'error' } : g));
              }
          };

          const GoalCard = ({ goal }) => {
              const progress = goal.isCompleted ? 100 : Math.min((balance / goal.targetAmount) * 100, 100);
              
              const getButtonText = () => {
                  if (goal.planStatus === 'generating') return "Generating...";
                  if (goal.planStatus === 'error') return "Error - Try Again";
                  return goal.budgetPlan ? "Refresh Plan" : "Generate AI Budget Plan";
              };

              return (
                  <div className="bg-surface p-6 rounded-xl shadow-md flex flex-col space-y-4">
                      <div className="flex justify-between items-start">
                          <div>
                              <h4 className="font-bold text-lg text-text-primary">{goal.name}</h4>
                              <p className="text-text-secondary">Target: ${goal.targetAmount.toLocaleString()}</p>
                          </div>
                          {goal.isCompleted && (
                              <div className="flex items-center text-accent-text font-semibold bg-accent-light px-3 py-1 rounded-full text-sm">
                                  <StarIcon className="w-5 h-5 mr-1 text-accent" />
                                  Completed!
                              </div>
                          )}
                      </div>
                      {!goal.isCompleted && (
                          <div>
                              <ProgressBar progress={progress} />
                              <p className="text-right text-sm text-text-secondary mt-1">{progress.toFixed(0)}% Funded</p>
                          </div>
                      )}
                      {!goal.isCompleted && (
                          <button 
                              onClick={() => handleGenerateOrUpdatePlan(goal)}
                              disabled={goal.planStatus === 'generating'}
                              className="w-full flex items-center justify-center text-sm font-semibold text-primary py-2 px-3 border border-primary rounded-lg hover:bg-primary-light transition-colors disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-wait"
                          >
                              {goal.planStatus === 'generating' ? <LoadingSpinner className="w-4 h-4 mr-2"/> : <SparklesIcon className="w-4 h-4 mr-2"/>}
                              {getButtonText()}
                          </button>
                      )}
                       {(goal.planStatus === 'generating' && !goal.budgetPlan) && (
                          <div className="text-center p-4 bg-background rounded-md">
                              <p className="text-sm text-text-secondary">AI is crafting your plan...</p>
                          </div>
                      )}
                      {goal.budgetPlan && (
                          <div className="prose prose-sm max-w-none p-4 bg-background rounded-md border border-border">
                              <ReactMarkdown>{goal.budgetPlan}</ReactMarkdown>
                          </div>
                      )}
                       {goal.planStatus === 'error' && (
                          <div className="text-center p-2 bg-danger-light text-danger-text rounded-md">
                              <p className="text-sm font-semibold">Failed to generate plan.</p>
                          </div>
                      )}
                  </div>
              );
          };

          return (
              <div>
                  <div className="flex justify-between items-center mb-6">
                      <h3 className="text-2xl font-bold text-text-primary">Your Savings Goals</h3>
                      <div className="flex space-x-2">
                          <button onClick={() => {setSuggestModalOpen(true); handleSuggestGoals();}} className="flex items-center px-4 py-2 text-sm font-medium text-primary-text bg-secondary rounded-md hover:bg-secondary-hover">
                              <SparklesIcon className="w-5 h-5 mr-2" />
                              Suggest Goals with AI
                          </button>
                          <button onClick={() => setAddModalOpen(true)} className="flex items-center px-4 py-2 text-sm font-medium text-primary-text bg-primary rounded-md hover:bg-primary-hover">
                              <PlusIcon className="w-5 h-5 mr-2" />
                              Add New Goal
                          </button>
                      </div>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                      {goals.map(goal => <GoalCard key={goal.id} goal={goal} />)}
                  </div>
                  
                  <Modal isOpen={isAddModalOpen} onClose={() => setAddModalOpen(false)} title="Set a New Goal">
                      <form onSubmit={handleAddGoal} className="space-y-4">
                          <div>
                              <label htmlFor="goal-name" className="block text-sm font-medium text-text-secondary">Goal Name</label>
                              <input type="text" id="goal-name" value={newGoalName} onChange={e => setNewGoalName(e.target.value)} className={formInputClasses} required/>
                          </div>
                          <div>
                              <label htmlFor="goal-amount" className="block text-sm font-medium text-text-secondary">Target Amount</label>
                              <input type="number" id="goal-amount" value={newGoalAmount} onChange={e => setNewGoalAmount(e.target.value)} className={formInputClasses} required step="0.01" />
                          </div>
                          <div className="flex justify-end pt-2">
                              <button type="submit" className="px-4 py-2 text-sm font-medium text-primary-text bg-primary border border-transparent rounded-md shadow-sm hover:bg-primary-hover">Set Goal</button>
                          </div>
                      </form>
                  </Modal>

                  <Modal isOpen={isSuggestModalOpen} onClose={() => setSuggestModalOpen(false)} title="AI Goal Suggestions">
                      {isLoadingSuggestions ? (
                          <div className="flex justify-center items-center h-48">
                              <LoadingSpinner className="w-10 h-10 text-primary" />
                          </div>
                      ) : (
                          <div className="space-y-3">
                              {suggestedGoals.map((g, i) => (
                                  <div key={i} className="p-4 bg-background rounded-lg flex justify-between items-center">
                                      <div>
                                          <p className="font-semibold text-text-primary">{g.name}</p>
                                          <p className="text-sm text-text-secondary">${g.targetAmount.toLocaleString()}</p>
                                      </div>
                                      <button onClick={() => {addGoal(g); setSuggestModalOpen(false);}} className="px-3 py-1 text-sm font-medium text-primary bg-primary-light rounded-full hover:bg-primary hover:text-primary-text transition-colors">Add</button>
                                  </div>
                              ))}
                               {suggestedGoals.length === 0 && !isLoadingSuggestions && (
                                  <div className="text-center py-8 text-text-secondary">
                                      <p>Could not generate suggestions. Please try again.</p>
                                  </div>
                              )}
                          </div>
                      )}
                  </Modal>
              </div>
          );
      };
      // --- END: components/GoalsView.js ---

      // --- START: App.js ---
      const sampleTransactions = [
          { id: '1', description: 'Monthly Salary', amount: 3500, date: new Date().toISOString().split('T')[0], type: TransactionType.INCOME, category: 'Salary' },
          { id: '2', description: 'Groceries', amount: 150.75, date: '2023-10-28', type: TransactionType.EXPENSE, category: 'Groceries' },
          { id: '3', description: 'Dinner with friends', amount: 65.50, date: '2023-10-27', type: TransactionType.EXPENSE, category: 'Dining Out' },
          { id: '4', description: 'Rent', amount: 1200, date: '2023-11-01', type: TransactionType.EXPENSE, category: 'Rent' },
      ];

      const sampleGoals = [
          { id: 'g1', name: 'New Laptop', targetAmount: 1500, isCompleted: false, planStatus: 'idle' },
          { id: 'g2', name: 'Vacation Fund', targetAmount: 2000, isCompleted: false, planStatus: 'idle' },
          { id: 'g3', name: 'Emergency Fund', targetAmount: 500, isCompleted: true, planStatus: 'idle' },
      ];

      const App = () => {
          const [view, setView] = useState('dashboard');
          const [transactions, setTransactions] = useState(sampleTransactions);
          const [goals, setGoals] = useState(sampleGoals);
          const [points, setPoints] = useState(125);
          const [isPremium, setIsPremium] = useState(false);
          const [isUpgradeModalOpen, setUpgradeModalOpen] = useState(false);
          const [categories, setCategories] = useState(DEFAULT_CATEGORIES);

          const { totalIncome, totalExpenses, balance } = useMemo(() => {
              const income = transactions
                  .filter(t => t.type === TransactionType.INCOME)
                  .reduce((sum, t) => sum + t.amount, 0);
              const expenses = transactions
                  .filter(t => t.type === TransactionType.EXPENSE)
                  .reduce((sum, t) => sum + t.amount, 0);
              return { totalIncome: income, totalExpenses: expenses, balance: income - expenses };
          }, [transactions]);

          useEffect(() => {
              const newlyCompletedGoalIds = new Set();
              goals.forEach(goal => {
                  if (!goal.isCompleted && balance >= goal.targetAmount) {
                      newlyCompletedGoalIds.add(goal.id);
                  }
              });

              if (newlyCompletedGoalIds.size > 0) {
                  setGoals(prevGoals =>
                      prevGoals.map(g =>
                          newlyCompletedGoalIds.has(g.id) ? { ...g, isCompleted: true } : g
                      )
                  );
                  setPoints(prev => prev + (POINTS_FOR_COMPLETING_GOAL * newlyCompletedGoalIds.size));
              }
          }, [balance, goals]);


          const addTransaction = (transaction) => {
              const newTransaction = { ...transaction, id: new Date().toISOString() };
              setTransactions(prev => [newTransaction, ...prev]);
              setPoints(prev => prev + POINTS_FOR_TRANSACTION);
              if (!categories.includes(transaction.category)) {
                  setCategories(prev => [...prev, transaction.category]);
              }
          };
          
          const addGoal = (goal) => {
              const newGoal = { ...goal, id: new Date().toISOString(), isCompleted: false, planStatus: 'idle' };
              setGoals(prev => [newGoal, ...prev]);
              setPoints(prev => prev + POINTS_FOR_NEW_GOAL);
          };

          const updateGoal = (updatedGoal) => {
              setGoals(goals.map(g => g.id === updatedGoal.id ? updatedGoal : g));
          };

          const deleteTransaction = (id) => {
              setTransactions(transactions.filter(t => t.id !== id));
          };

          const renderView = () => {
              const financialSummary = { totalIncome, totalExpenses, balance };
              switch (view) {
                  case 'transactions':
                      return <TransactionsView transactions={transactions} addTransaction={addTransaction} deleteTransaction={deleteTransaction} categories={categories} isPremium={isPremium} />;
                  case 'goals':
                      return <GoalsView goals={goals} setGoals={setGoals} addGoal={addGoal} balance={balance} financialSummary={financialSummary} transactions={transactions} />;
                  case 'dashboard':
                  default:
                      return <Dashboard summary={financialSummary} goals={goals} isPremium={isPremium} />;
              }
          };
          
          const NavItem = ({ targetView, icon, label }) => (
              <button
                  onClick={() => setView(targetView)}
                  className={`flex items-center w-full px-4 py-3 rounded-lg transition-colors duration-200 ${
                      view === targetView
                          ? 'bg-primary text-primary-text shadow-md'
                          : 'text-text-secondary hover:bg-primary-light hover:text-primary'
                  }`}
              >
                  {icon}
                  <span className="ml-3 font-medium">{label}</span>
              </button>
          );

          return (
              <div className="flex h-screen bg-background font-sans text-text-primary">
                  {/* Sidebar */}
                  <aside className="w-64 bg-surface p-4 flex flex-col border-r border-border">
                      <div className="flex items-center mb-8">
                          <div className="bg-brand text-white p-2 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                          </div>
                          <h1 className="text-2xl font-bold ml-3 text-brand">Zenith</h1>
                      </div>
                      <nav className="flex flex-col space-y-2">
                          <NavItem targetView="dashboard" icon={<DashboardIcon className="w-6 h-6" />} label="Dashboard" />
                          <NavItem targetView="transactions" icon={<TransactionsIcon className="w-6 h-6" />} label="Transactions" />
                          <NavItem targetView="goals" icon={<GoalsIcon className="w-6 h-6" />} label="Goals" />
                      </nav>
                      <div className="mt-auto">
                         <div className="bg-warning-light border-l-4 border-warning text-warning-text p-4 rounded-lg">
                           <p className="font-bold">Gamification</p>
                           <p className="text-sm">Earn points for managing your finances well!</p>
                         </div>
                      </div>
                  </aside>
                  
                  {/* Main Content */}
                  <div className="flex-1 flex flex-col overflow-hidden">
                      {/* Header */}
                      <header className="bg-surface border-b border-border p-4 flex justify-between items-center">
                          <h2 className="text-2xl font-bold capitalize">{view}</h2>
                          <div className="flex items-center space-x-4">
                              <div className="flex items-center bg-primary-light text-primary font-bold py-2 px-4 rounded-full">
                                  <StarIcon className="w-5 h-5 mr-2 text-warning" />
                                  {points} Points
                              </div>
                              <button 
                                onClick={() => setUpgradeModalOpen(true)}
                                className="flex items-center bg-gradient-to-r from-primary to-indigo-700 text-white font-semibold py-2 px-4 rounded-full shadow-lg hover:scale-105 transform transition-transform duration-200"
                              >
                                  <SparklesIcon className="w-5 h-5 mr-2" />
                                  {isPremium ? 'Premium User' : 'Upgrade to Premium'}
                              </button>
                          </div>
                      </header>

                      {/* Content Area */}
                      <main className="flex-1 overflow-y-auto p-8">
                          {renderView()}
                      </main>
                  </div>

                  <Modal title="Upgrade to Zenith Premium" isOpen={isUpgradeModalOpen} onClose={() => setUpgradeModalOpen(false)}>
                      <div className="space-y-4">
                          <p className="text-text-secondary">Unlock powerful AI features to supercharge your financial journey.</p>
                          <ul className="list-disc list-inside space-y-2 text-text-primary">
                              <li><span className="font-semibold">AI Receipt Scanning:</span> Instantly log expenses by taking a photo of your receipts.</li>
                              <li><span className="font-semibold">AI "What If?" Scenario Planner:</span> Simulate financial changes and see their impact on your goals.</li>
                          </ul>
                          {isPremium ? (
                              <p className="text-center font-semibold text-accent-text p-3 bg-accent-light rounded-lg">You are already a Premium member!</p>
                          ) : (
                              <button
                                  onClick={() => {
                                      setIsPremium(true);
                                      setUpgradeModalOpen(false);
                                  }}
                                  className="w-full bg-primary text-primary-text font-bold py-3 px-4 rounded-lg hover:bg-primary-hover transition-colors"
                              >
                                  Subscribe Now
                              </button>
                          )}
                      </div>
                  </Modal>
              </div>
          );
      };
      // --- END: App.js ---
      
      // --- FINAL RENDER LOGIC ---
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );

    </script>
  </body>
</html>
